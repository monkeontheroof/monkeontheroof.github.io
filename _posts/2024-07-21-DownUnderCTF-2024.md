---
layout: post
title:  "DownUnderCTF - 2024 - Writeup"
description: Solutions for some web challenges
tags: [DUCTF, CTF, 2024, Web, Writeup, Red Team, Offensive, Challenge, Beginner]
---
Hello everyone, this is my first blog post as I officially join a CTF competition for the first time (although I didn't get higher ranking). DownUnderCTF 2024 is quite interesting and beginner friendly, let's dive into some Web Challenges!!<br>
<!-- <img src="https://media.discordapp.net/attachments/1232921552899670089/1259443092885344356/fish4finn-certificate.png?ex=66a21cc8&is=66a0cb48&hm=d1949289593e81f5415cb28eaac1e95c6be9041155feed50653689526b3c9fda&=&format=webp&quality=lossless&width=662&height=468" style="width: 400px"> -->

# parrot the emu (100 pts)
Come to our first challenge, I was given the source code attachment and challenge URL.<br>
<!-- <img src="https://github.com/user-attachments/assets/6b55e55b-573a-4273-b760-253783f5469e"> -->

After investigating, I found that this site uses Flask as a web framework and has a feature that prints back anything I entered
![image](https://github.com/user-attachments/assets/97893fac-f0b2-4cb4-a5ed-14dcd93d93d8)

Take a look at `app.py`, we can see that at line 12 our input is passed directly into `render_template_string()` without filtering or sanitization, then the appended result will be rendered using `index.html`. <br>
![app.py](https://github.com/user-attachments/assets/d2f5393b-1582-447e-b334-740379909e8c) <br>
This may have the potential for SSTI since my input is passed directly into template rather than passed in as data
> "Since autoescaping is enabled for all strings when using `render_template_string()` so I guess there is no XSS here"

Let's prove it: <br>
![image](https://github.com/user-attachments/assets/f61813de-a03b-4584-bd51-009a3f2b5a26) <br>
As expected, I have succeeded in extracting the configuration variables. I crafted a payload that used for RCE and attempt to read the flag via `os` class from global objects *( do not forget to place it between double curly braces )*:

```
config.__class__.__init__.__globals__['os'].popen('cat flag').read()
```

**What have I learned:** New concepts and SSTI exploitation for Flask. <br>
**FLAG: `DUCTF{PaRrOt_EmU_ReNdErS_AnYtHiNg}`**

---
# zoo feedback form (100 pts)
As previous challenge, this time we meet Flask again xD <br>
I was also given the source code and URL for this challenge. We got a single website with a feature that allows us to submit feedback to the server. Then the server prints back my feedback to me <br>
![image](https://github.com/user-attachments/assets/9b2750bd-cd80-4f8d-a223-46e996e54204)

When observing the application, I found that they implemented XML for transmitting data between client and server, this has inadvertently exposed a vulnerability it should not existed. Let's prove for XXE injection!<br>
At line 9, server accepts user input without filtering or sanitization and then parses it as an XML document and return the root node.
Next the server will find feedback node and get its value, then render the feedback's value as a template string <br>
![image](https://github.com/user-attachments/assets/7eca07dd-57e0-4dfc-b340-ac0e2ff75f4c)

Now we've got all informations that we need for the exploitation, let's try to retrieve a system file. Ex: `/etc/passwd` <br>
![image](https://github.com/user-attachments/assets/e95db890-dc27-4cc3-a09d-da957a09d571)

Whoooops, Gotcha !! Now I can change the file path to `/app/flag.txt` to get the flag

**What I have learned:** Different types of Markup languages and their vulnerability type. <br>
**FLAG: `DUCTF{emU_say$_he!!0_h0!@_ci@0}`**

---
# co2 (100 pts)
Same as previous, this time I also got a docker compose file so I'm gonna build it locally. <br>
Once again, Flask!!! It seems like I'm quite lucky to participate in this competition because it is also an opportunity for me to expand my knowledge about Flask as well as Python in general. <br>
After some trial and error, I came up with these informations:
- The flag is located at `/get_flag`, but we cannot get the flag since it is expecting the `flag` environment variable to be true *(contrary to the value in the .env file)*
- The save feedback feature merges user's JSON input into the properties of a Feedback object and saves them locally on the server.
- Discovered some hints in the source code:

> "Not quite sure how many fields we want for this, lets just collect these bits now and increase them later."
> "Is it possible to dynamically add fields to this object based on the fields submitted by users?"

Combining the above informations, we could try to prove for Server-side Prototype Pollution:
First, make a POST request to `/save_feedback` with additional fields: <br>
![image](https://github.com/user-attachments/assets/233e2b27-e3fc-4e26-aec4-7635d018846c)

In docker container, find those saved feedbacks at `/app/feedback`. If it successfully parsed, we could see those injected fields in feedback files: <br>
> Even though properties starting with double underscore "__" are not written to file, they are still be merged into Feedback object
<img src="https://github.com/user-attachments/assets/129203a4-312c-4a43-a6fd-2a668ffcfe9f" width=500>

Change the payload like below to set the `flag` env to `true`:

```json
{"title":"test","content":"test","rating":"1","referred":"test",
"__class__":{
"__init__":{
"__globals__":{
"flag":"true"}}}}
```

Route to `/get_flag` to get the flag

**What I have learned:** Learned a new bug type that I've never done before, it just took me an hour to learn and solve this lab xD <br>
**FLAG: `DUCTF{_cl455_p0lluti0n_ftw_}`** 

Thank you so much for reading my very first blog :> I have also solved some OSINT challenges but haven't written write-up for it yet, maybe next post xD. See you in the next CTF!!
